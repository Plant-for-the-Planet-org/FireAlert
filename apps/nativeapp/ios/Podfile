# File: ios/Podfile  (REPLACE ENTIRE FILE)
require Pod::Executable.execute_command('node', ['-p',
  'require.resolve(
    "react-native/scripts/react_native_pods.rb",
    {paths: [process.argv[1]]},
  )', __dir__]).strip

require_relative '../../../node_modules/@react-native-community/cli-platform-ios/native_modules'

$RNMapboxMapsImpl = 'mapbox'

# React Native >= 0.76 requires iOS 15.1 minimum; set to 15.1 to satisfy ReactCommon / turbomodule pods.
platform :ios, '15.1'
prepare_react_native_project!

# Ensure consistent frameworks linkage for host app + extension.
linkage = ENV['USE_FRAMEWORKS']
if linkage
  use_frameworks! :linkage => linkage.to_sym
else
  use_frameworks!
end

# capture reactNativePath for post_install
$react_native_path = nil

target 'FireAlert' do
  config = use_native_modules!
  $react_native_path = config[:reactNativePath]

  # legacy radial gradient commented out â€” omitted because project doesn't use it.
  # pod 'SRSRadialGradient', :path => '../../../node_modules/react-native-radial-gradient/ios'

  use_react_native!(
    :path => config[:reactNativePath],
    :app_path => "#{Pod::Config.instance.installation_root}/.."
  )

  target 'FireAlertTests' do
    inherit! :complete
  end

  # Mapbox pre_install hook (if using @rnmapbox/maps)
  pre_install do |installer|
    $RNMapboxMaps.pre_install(installer) if defined?($RNMapboxMaps)
  end
end

# Notification Service Extension: do NOT call use_frameworks! here (already global above)
target 'OneSignalNotificationServiceExtension' do
  # Pin exact XCFramework version required by react-native-onesignal
  pod 'OneSignalXCFramework', '= 5.2.14'
end

post_install do |installer|
  # Force pods' IPHONEOS_DEPLOYMENT_TARGET to match platform :ios above (fixes "required a higher minimum deployment target" errors)
  installer.pods_project.targets.each do |target|
    target.build_configurations.each do |config|
      config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '15.1'
    end
  end

  # Run React Native's post-install hook (uses $react_native_path captured above)
  react_native_post_install(
    installer,
    $react_native_path,
    :mac_catalyst_enabled => false
  )
end
